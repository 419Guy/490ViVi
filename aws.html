<html>
  <head>
    <title>BOOK App</title>
    <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
    <script>
    	function getBookDetails(){
    	  var isbn = document.getElementById("isbn").value;
    	  if(isNaN(isbn)){
    	  	document.getElementById("warning").style.visibility = "visible";
    	  	return;
    	  }
    	  
		  var xhttp = new XMLHttpRequest();
		  xhttp.onreadystatechange = function(){
			if(this.readyState == 4 && this.status == 200){
			document.getElementById("title").value = xhttp.responseText;
			getAmazonURL();
			}
		  };
		  xhttp.open('GET',
		  'https://web.njit.edu/~cab56/isbn/isbn.php?isbn='+isbn,
		  true);
		  xhttp.send();
		  
		  return false;
		}
		
		//JEROME:main function that utilizes the backend "test3.php"
		function getBookFromBookstore(){
		  var bookstore_url = document.getElementById("bookstore_url").value;
		  var xhttp = new XMLHttpRequest();
		  xhttp.onreadystatechange = function(){
			if(this.readyState == 4 && this.status == 200){
				
				var element = document.getElementById("url_links");
				
				//JEROME:xhttp.responseText is the amazon URL(s)
				JSON.parse(xhttp.responseText).forEach(function(url_name){
					var para = document.createElement("a");
					var br = document.createElement("br");
					var node = document.createTextNode("Amazon Link");
					para.appendChild(node);
					para.setAttribute('href', url_name);
					element.appendChild(para);
					element.appendChild(br);
				});
			}
		  };
		  //JEROME:replace path to wherever you put this
		  xhttp.open('POST',
		  'https://web.njit.edu/~cab56/isbn/test3.php',
		  true);
		  xhttp.setRequestHeader('Content-Type', 'application/json');
		  xhttp.send(bookstore_url);
		  
		  return false;
		}
		
		
		function getAmazonURL(){
    	  var isbn = document.getElementById("isbn").value;

		  var xhttp = new XMLHttpRequest();
		  xhttp.onreadystatechange = function(){
			if(this.readyState == 4 && this.status == 200){
				document.getElementById("url").href = xhttp.responseText;
				console.log(xhttp.responseText);
			}
		  };
		  xhttp.open('GET',
		  'https://web.njit.edu/~cab56/isbn/test.php?isbn='+isbn,
		  true);
		  xhttp.send();
		  
		  return false;
		}
		
		function isbnChange(){
			document.getElementById("warning").style.visibility = "hidden";
			var isbn = document.getElementById("isbn").value;
			if(isbn.length == 10 || isbn.length == 13){
				document.getElementById("bookReq").disabled = false;
			}else{
				document.getElementById("bookReq").disabled = true;
			}
		}
    </script>
    <meta charset="UTF-8">
  </head>
  <body>
 		<button id="bookReq" onclick="getBookDetails()" disabled>Get Book</button>
 		<input type="text" id="isbn" onkeyup="isbnChange()">
 		<br />
 		Book Title: <input type="text" id="title" size="50" readonly>
 		<p id="warning" style="visibility:hidden; color:#ff0000;">*ISBN is not an integer</p>
 		
 		<button id="bookstoreReq" onclick="getBookFromBookstore()">Get Book (URL)</button>
 		<input type="text" id="bookstore_url">
 		
 		<p>
 		some values that work: <br />
 		0471104264 <br />
 		0596002068 <br />
 		1491947179 <br />
 		9781133187790 <br />
 		
 		<br>
 		bookstore URL:<br>
 		http://www.bkstr.com/webapp/wcs/stores/servlet/booklookServlet?bookstore_id-1=584&term_id-1=2016+Fall&crn-1=91543
 		http://www.bkstr.com/webapp/wcs/stores/servlet/booklookServlet?bookstore_id-1=584&term_id-1=2016+Fall&crn-1=92768
 		</p>
 		<!-JEROME:location of the url links will appear below here->
 		<div id="url_links">
 		</div>
  </body>
</html>
